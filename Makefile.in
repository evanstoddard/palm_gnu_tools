# Makefile for prc-tools.
#
# Copyright (c) 1999 Palm Computing, Inc. or its subsidiaries.
# All rights reserved.
#
# This is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2, or (at your option)
# any later version.

srcdir = @srcdir@
VPATH = @srcdir@

palmdev_prefix = @sharedstatedir@
full_target = @target@
configured_subdirs = @subdirs@

INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@

host_subdirs = $(configured_subdirs) doc tools
target_subdirs = crt libc libm

# This target will only work if you are willing to do all your building as
# a user who can write to your install directory, i.e., if you build as root
# or if you're on an unprotected file system like Windows.

all-install: all-host install-host all-gcc install-gcc \
             install-palmdev all-target install-target

all-host:
	for dir in `echo $(host_subdirs) | sed -e 's/gcc//' -e 's/make//'`; do \
	  if [ -f ./$${dir}/Makefile ]; then \
	    if (cd $${dir} && $(MAKE) all info); then true; else exit 1; fi; \
	  fi; \
	done

all-gcc:
	if [ -f ./gcc/Makefile ]; then \
	  if (cd gcc && $(MAKE)); then true; else exit 1; fi; \
	fi

all-target:
	for dir in $(target_subdirs); do \
	  if [ -f ./$${dir}/Makefile ]; then \
	    if (cd $${dir} && $(MAKE) all); then true; else exit 1; fi; \
	  fi; \
	done

install-host:
	for dir in `echo $(host_subdirs) | sed -e 's/gcc//' -e 's/make//'`; do \
	  if [ -f ./$${dir}/Makefile ]; then \
	    if (cd $${dir} && $(MAKE) install install-info); then true; else exit 1; fi; \
	  fi; \
	done

install-gcc:
	if [ -f ./gcc/Makefile ]; then \
	  if (cd gcc && $(MAKE) LANGUAGES="c c++" install); then true; else exit 1; fi; \
	fi

install-target:
	for dir in $(target_subdirs); do \
	  if [ -f ./$${dir}/Makefile ]; then \
	    if (cd $${dir} && $(MAKE) install); then true; else exit 1; fi; \
	  fi; \
	done

clean:
	for dir in $(host_subdirs) $(target_subdirs); do \
	  if [ -f ./$${dir}/Makefile ]; then \
	    if (cd $${dir} && $(MAKE) clean); then true; else exit 1; fi; \
	  fi; \
	done

install-palmdev:
	$(INSTALL) -d $(palmdev_prefix)/doc
	$(INSTALL) -d $(palmdev_prefix)/include
	$(INSTALL) -d $(palmdev_prefix)/lib/$(full_target)
	$(INSTALL_DATA) $(srcdir)/COPYING $(palmdev_prefix)/doc/COPYING
	$(INSTALL_DATA) $(srcdir)/README $(palmdev_prefix)/doc/README
