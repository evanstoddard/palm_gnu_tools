<html>
<head>
<title>Building prc-tools</title>
</head>

<body>

<h1>Building prc-tools</h1>

Prc-tools is built regularly on Linux and Cygwin, and should build without
too much trouble on other Unix-like systems.  (Any problems encountered are
bugs and we would like to hear about them.)  These regular builds are done
either with the RPM spec file <code>prc-tools.spec</code> or with the
<code>cygwin-build</code> script.  While we attempt to keep these instructions
up to date, those two files should be considered to represent the canonical
tested build procedures.

<p>
In this document, we use <code>prc-tools-srcdir</code> to refer to the top
level source directory for prc-tools.  If you are working from CVS, this
directory's name will be simply <code>prc-tools</code>.  If you have downloaded
a source tarball, it will be something like <code>prc-tools-2.1</code>.

<h2>Prc-tools and Palm OS SDKs</h2>

Prc-tools contains both host tools which run on your development computer
and run-time support code which is linked into your application.  Header
files of some kind describing how to call several Palm OS API functions
are needed to compile this run-time support code.

<p>
For a Palm OS application, these header files are provided by a Palm OS
SDK.  However, the audience for prc-tools is different:  It is often built
by people, such as system administrators and OS distributors, who may not
themselves be Palm OS programmers.  It is unreasonable to require such
people to first obtain a separate non-redistributable SDK that they may not
subsequently wish to use, just so that they can compile a small part of
this package.

<p>
Hence prc-tools contains header files (in the <code>bootstrap</code>
subdirectory) which declare just enough Palm OS API functions and related
machinery to compile the run-time support code.  Thus prc-tools itself can
be compiled by itself, without requiring any separate Palm OS SDK to be
installed on the build system.  (Of course people later <b>using</b>
prc-tools will likely need to obtain an SDK themselves if they wish to
write non-trivial applications.)

<p>
See <a href="http://bugs.debian.org/78745">Debian bug #78745</a> and
<code>bootstrap/Makefile</code> for further details of this arrangement.

<h2>Build tools required</h2>

You will need to have a C compiler, a C++ compiler, lex or
<a href="http://www.gnu.org/software/flex/flex.html">flex</a>, and
yacc or <a href="http://www.gnu.org/software/bison/bison.html">bison</a>
installed.  Some of the post-linker tools are written with C++ and
<a href="http://www.sgi.com/Technology/STL/">STL</a>, so if you are using
GCC you will need at least egcs 1.1.1 or so, or any GCC 2.95.  If your
normal <code>gcc</code> or <code>cc</code> is earlier than this but
you have a recent GCC installed as, e.g., <code>gcc295</code>,
you can specify that the tools be built using the non-default compiler
by defining variables for the configure command:
<blockquote><pre>
~/build$ CC=gcc295 CXX=g++295 ../prc-tools-srcdir/configure <i>...etc...</i>
</pre></blockquote>

<p>
Particularly if you are a maintainer working on prc-tools, you may also
need the following:
<ul>
<li>
If you do much work on the configuration files or are working from CVS, you'll
need <a href="http://sources.redhat.com/autoconf/">autoconf</a>.

<li>
If you are working on the run-time support code, you may need to update the
<code>bootstrap</code> headers.
A <a href="http://www.palmos.com/dev/tech/tools/">Palm OS SDK</a>
and some Palm OS device (such as
<a href="http://www.palmos.com/dev/tech/tools/emulator/">Poser</a>
and a ROM) are needed to do this, because the headers are generated by running
a Palm OS application, GenBootstrap.

<li>
If you want to generate the HTML documentation, you'll need
<a href="http://wwwinfo.cern.ch/dis/texi2html/">texi2html</a>.
<!-- need to check on this
(On Windows, you'll need either a
<a href="http://cygutils.netpedia.net/">Cygwin-ised perl</a> or some fairly
serious heroics involving
<a href="http://sources.redhat.com/cygwin/cygwin-ug-net/using-utils.html#CYGPATH">cygpath</a>.)
-->

<!-- this I think isn't a problem anymore either
<li>
On Windows, I've found that Cygwin gives you a <code>makeinfo</code> that's
just <code>/bin/true</code> (i.e., a shell script that doesn't do anything)!
If your Cygwin suffers from this, you might want to build and install this
<a href="http://www.palm.com/devzone/tools/gcc/dist/makeinfo.c">makeinfo.c</a>
which will at least create an output file to keep the makefiles happy.
-->
</ul>

<h2>Unpacking and patching the sources</h2>

This prc-tools package contains source code for the post-linker tools and
run-time support on the device, and patches against 
<a href="ftp://sources.redhat.com/pub/binutils/releases/">binutils-2.9.1</a>,
<a href="ftp://sources.redhat.com/pub/gdb/releases/">gdb-5.0</a>, and
<a href="ftp://gcc.gnu.org/pub/gcc/releases/">gcc-2.95.3</a>.
You will need to download source for each of these packages separately, either
from a <a href="http://www.gnu.org/order/ftp.html">GNU mirror</a> or from
<a href="http://prc-tools.sourceforge.net/misc/">http://prc-tools.sourceforge.net/misc/</a>.
Prc-tools also includes patches to generate HTML documentation for
<a href="http://www.gnu.org/software/make/make.html">make</a>;
if you want to generate this, you will also need
<a href="ftp://ftp.gnu.org/pub/gnu/make/">make-3.77</a> source code.

<p>
Once you have downloaded the packages, you need to unpack them and apply
the patches:
<blockquote><pre>
~$ tar xfz prc-tools-2.1.tar.gz
~$ tar xfz binutils-2.9.1.tar.gz
~$ tar xfz gdb-5.0.tar.gz
~$ tar xfz gcc-2.95.3.tar.gz
~$ tar xfz make-3.77.tar.gz
~$ cat prc-tools-srcdir/*.palmos.diff | patch -p0
</pre></blockquote>
(Omit <code>make-3.77.tar.gz</code> and <code>make-docs-3.77.palmos.diff</code>
if you don't want to generate make documentation.)

<p>
On Windows, you should also apply the Cygwin-specific patches:
<blockquote><pre>
~$ cat prc-tools-srcdir/*.cygwin.diff | patch -p0
</pre></blockquote>

<p>
If you don't have autoconf installed, you need to fix the datestamp
on <code>cstamp-h.in</code> to prevent autoconf from being invoked to
regenerate it:
<blockquote><pre>
~$ touch gcc-2.95.3/gcc/cstamp-h.in
</pre></blockquote>

<p>
Finally, you need to make the GNU packages available to prc-tools's configure
script and top-level Makefile so that building all the packages can be
integrated into just one build:

<blockquote><pre>
~$ cd prc-tools-srcdir
~/prc-tools-srcdir$ ln -s ../binutils-2.9.1 binutils
~/prc-tools-srcdir$ ln -s ../gdb-5.0 gdb
~/prc-tools-srcdir$ ln -s ../gcc-2.95.3 gcc
~/prc-tools-srcdir$ ln -s ../make-3.77 make
~/prc-tools-srcdir$ cd ..
</pre></blockquote>
(On Windows, if you use any non-Cygwin programs in your build (such as the
texi2html perl script), you should use <code>mv</code> instead of
<code>ln -s</code> since non-Cygwin programs can't see through Cygwin's
symlinks.)

<h2>Configuring</h2>

It's <a href="http://gcc.gnu.org/install/configure.html">recommended</a>
that you configure and build these packages in a directory separate from
their source trees:

<blockquote><pre>
~$ mkdir build
~$ cd build
~/build$ mkdir empty
~/build$ ../prc-tools-srcdir/configure --target=m68k-palmos \
         --enable-languages=c,c++ \
	 --with-headers=`pwd`/empty
</pre></blockquote>

(The parameters above must be given, with whatever values are appropriate,
because their defaults will cause problems.)  In addition to the standard
configure options, the following options can be used:
<dl>
<dt>
<code>--target=m68k-palmos</code>
<dd>
Sets the target platform for the tool chain.  The target used in
prc-tools-0.5.0 was <code>m68k-palmos-coff</code>; dropping the
<code>-coff</code> now will ease a potential future move to ELF, and
just plain makes more sense.  But at the moment <code>m68k-palmos</code>
is merely an alias for <code>m68k-palmos-coff</code>, so you can use
the full name for compatibility with prc-tools-0.5.0 for now if you like.
<dt>
<code>--enable-languages=c,c++</code>
<dd>
Only build C and C++ compilers.  In particular, the Objective-C runtime
hasn't been ported to Palm OS, so <code>objc</code> won't work here.
<dt>
<code>--with-headers=`pwd`/empty</code>
<dd>
GCC fixes system headers by filtering out non-ISO standard constructs.
Pointing it at an empty directory like this effectively suppresses that
behaviour -- which may or may not be the best idea, but it makes life
easier for now.  :-)
<dt>
<code>--with-build-sdk[=-palmosX]</code>
<dd>
Select an installed Palm OS SDK with which to build the runtime code.
By default, the header files in prc-tools's <code>bootstrap</code> directory
are used, which provide just enough functionality to compile the startup code.
<dt>
<code><a name="palmdev-prefix">--with-palmdev-prefix=/opt/palmdev</a></code>
<dd>
This is where the tool chain
will look for Palm OS SDK headers and libraries and so on.
You can put this wherever you like; by convention, we use
<code>/opt/palmdev</code> on Unix and <code>/PalmDev</code>
on Windows.  By default, the tool chain will look in <code>/opt/palmdev</code>.
<dt>
<code>--with-palmdev-extra-path=/usr/local/palmdev:/somewhere/else</code>
<dd>
Additional directories which should be searched for SDK headers and libraries.
This can be set to provide compatibility with earlier prc-tools releases which
looked in <code>/usr/local/palmdev</code>.  By default, no additional
directories are searched.
</dl>

<h2>Building and installing</h2>

If you're using an unprotected file system like Windows, or if you are
willing to do all your building as a user who can write to your install
directory (i.e., root), you can build and install in one fell swoop:
<blockquote><pre>
~/build# make all-install
</pre></blockquote>

<p>
Otherwise, you'll need to make each of the dependencies of
<code>all-install</code> explicitly, since the various builds and installs
are interleaved:
<blockquote><pre>
~/build$ make all-host
~/build$ su
~/build# make install-host
~/build# ^D
~/build$ make all-gcc
~/build$ su
~/build# make install-gcc
~/build# make install-wrappers
~/build# ^D
~/build$ make all-target
~/build$ su
~/build# make install-target
</pre></blockquote>
(This is less ridiculous if you happen to be building only <em>part</em> of
the tool chain!)

<p>
The multistage process is needed because GCC requires binutils to be installed
before it can be built (or we could use the
<a href="http://www.objsw.com/CrossGCC/FAQ-4.html#ss4.2">unified binutils/gcc
tree</a> trick, but that would cause other problems for us); and in turn
the run-time support code such as that in the <code>crt</code> subdirectory
needs GCC to be installed before it can be built.

<p>
There are further details in the GCC distribution's
<a href="http://gcc.gnu.org/install/"><code>install</code> directory</a>
and also in the <a href="http://www.objsw.com/CrossGCC/">Cross-FAQ</a>,
if you run into problems.

<h2>Generating and installing the HTML documentation</h2>

The HTML documentation is not currently integrated with the rest of the
build (since it really wants to be a configure option:
<code>--enable-html-docs</code> or some such).  If you want to generate
these, you need to do it separately:
<blockquote><pre>
~/build$ cd doc
~/build/doc$ make html
~/build/doc$ su
~/build/doc# make install-html
</pre></blockquote>

<p><hr>
<i>To the <a href="http://prc-tools.sourceforge.net/">prc-tools website</a></i>

</body>
</html>
