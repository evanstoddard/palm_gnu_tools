diff -urN orig-binutils-2.11.2/bfd/coff-m68k.c binutils-2.11.2/bfd/coff-m68k.c
--- orig-binutils-2.11.2/bfd/coff-m68k.c	Thu Jun  7 03:08:23 2001
+++ binutils-2.11.2/bfd/coff-m68k.c	Tue Jan  8 22:55:42 2002
@@ -106,6 +106,7 @@
   HOWTO(R_PCRWORD,	       0,  1, 	16, true,  0, complain_overflow_signed, RELOC_SPECIAL_FN, "DISP16",   true, 0x0000ffff,0x0000ffff, false),
   HOWTO(R_PCRLONG,	       0,  2, 	32, true,  0, complain_overflow_signed, RELOC_SPECIAL_FN, "DISP32",   true, 0xffffffff,0xffffffff, false),
   HOWTO(R_RELLONG_NEG,	       0,  -2, 	32, false, 0, complain_overflow_bitfield, RELOC_SPECIAL_FN, "-32",	true, 0xffffffff,0xffffffff, false),
+  HOWTO(R_RELENDWORD,	       0,  1,   16, false, 0, complain_overflow_bitfield, RELOC_SPECIAL_FN, "END16",    true, 0x0000ffff,0x0000ffff, false),
 };
 #endif /* not ONLY_DECLARE_RELOCS */
 
@@ -139,6 +140,7 @@
    case R_PCRWORD:	internal->howto = m68kcoff_howto_table + 4; break;
    case R_PCRLONG:	internal->howto = m68kcoff_howto_table + 5; break;
    case R_RELLONG_NEG:	internal->howto = m68kcoff_howto_table + 6; break;
+   case R_RELENDWORD:	internal->howto = m68kcoff_howto_table + 7; break;
   }
 }
 
@@ -149,6 +151,10 @@
 m68k_howto2rtype (internal)
      reloc_howto_type *internal;
 {
+  /* FIXME: not sure if we need to handle this one.  */
+  if (internal->type == R_RELENDWORD)
+    abort ();
+
   if (internal->pc_relative)
   {
     switch (internal->bitsize)
@@ -189,6 +195,7 @@
     case BFD_RELOC_16_PCREL:	return m68kcoff_howto_table + 4;
     case BFD_RELOC_32_PCREL:	return m68kcoff_howto_table + 5;
       /* FIXME: There doesn't seem to be a code for R_RELLONG_NEG.  */
+      /* FIXME: Nor for R_RELENDWORD.  */
     }
   /*NOTREACHED*/
 }
@@ -203,6 +210,42 @@
 
 #define coff_bfd_reloc_type_lookup m68k_reloc_type_lookup
 
+#ifndef coff_rtype_to_howto
+/* If this is not yet defined, one of the following definitions will be
+   used.  Both need this helper function.  */
+
+static bfd_vma
+m68kcoff_global_data_size (abfd, sec, rel, h)
+     bfd *abfd;
+     asection *sec;
+     struct internal_reloc *rel;
+     struct coff_link_hash_entry *h;
+{
+  struct bfd_link_info *info;
+  struct coff_link_hash_entry *edata;
+
+  info = coff_data (sec->output_section->owner)->link_info;
+
+  edata = coff_link_hash_lookup (coff_hash_table (info), "edata",
+				 false, false, true);
+
+  if (edata && (edata->root.type == bfd_link_hash_defined
+		|| edata->root.type == bfd_link_hash_defweak))
+    {
+      return edata->root.u.def.value;
+    }
+  else
+    {
+      (*info->callbacks->warning) (info,
+				   "END16 relocation failed without `edata'",
+				   h? h->root.root.string : NULL, abfd, sec,
+				   rel->r_vaddr - sec->vma);
+      return 0;
+    }
+}
+
+#endif
+
 #ifndef COFF_COMMON_ADDEND
 #ifndef coff_rtype_to_howto
 
@@ -215,10 +258,10 @@
 
 static reloc_howto_type *
 m68kcoff_rtype_to_howto (abfd, sec, rel, h, sym, addendp)
-     bfd *abfd ATTRIBUTE_UNUSED;
+     bfd *abfd;
      asection *sec;
      struct internal_reloc *rel;
-     struct coff_link_hash_entry *h ATTRIBUTE_UNUSED;
+     struct coff_link_hash_entry *h;
      struct internal_syment *sym ATTRIBUTE_UNUSED;
      bfd_vma *addendp;
 {
@@ -232,6 +275,9 @@
   if (howto->pc_relative)
     *addendp += sec->vma;
 
+  if (rel->r_type == R_RELENDWORD)
+    *addendp -= m68kcoff_global_data_size (abfd, sec, rel, h);
+
   return howto;
 }
 
@@ -375,7 +421,7 @@
 
 static reloc_howto_type *
 m68kcoff_common_addend_rtype_to_howto (abfd, sec, rel, h, sym, addendp)
-     bfd *abfd ATTRIBUTE_UNUSED;
+     bfd *abfd;
      asection *sec;
      struct internal_reloc *rel;
      struct coff_link_hash_entry *h;
@@ -392,6 +438,9 @@
   if (howto->pc_relative)
     *addendp += sec->vma;
 
+  if (rel->r_type == R_RELENDWORD)
+    *addendp -= m68kcoff_global_data_size (abfd, sec, rel, h);
+
   if (sym != NULL && sym->n_scnum == 0 && sym->n_value != 0)
     {
       /* This is a common symbol.  The section contents include the
diff -urN orig-binutils-2.11.2/bfd/config.bfd binutils-2.11.2/bfd/config.bfd
--- orig-binutils-2.11.2/bfd/config.bfd	Thu Jun 14 11:16:59 2001
+++ binutils-2.11.2/bfd/config.bfd	Wed Jan  2 14:05:07 2002
@@ -161,6 +161,10 @@
     targ_defvec=bfd_elf32_littlearm_oabi_vec
     targ_selvecs=bfd_elf32_bigarm_oabi_vec
     ;;
+  arm-*-palmos*)
+    targ_defvec=bfd_elf32_littlearm_vec
+    targ_selvecs=bfd_elf32_bigarm_vec
+    ;;
 
   thumb-*-coff)
     targ_defvec=armcoff_little_vec
@@ -566,6 +570,9 @@
     targ_defvec=bfd_elf32_m68k_vec
     targ_selvecs=ieee_vec
     targ_underscore=yes
+    ;;
+  m68*-*-palmos*)
+    targ_defvec=m68kcoff_vec
     ;;
 
   m88*-harris-cxux* | m88*-*-dgux* | m88*-*-sysv4*)
diff -urN orig-binutils-2.11.2/config.sub binutils-2.11.2/config.sub
--- orig-binutils-2.11.2/config.sub	Thu Mar 22 11:12:23 2001
+++ binutils-2.11.2/config.sub	Wed Jan  2 14:05:07 2002
@@ -255,6 +255,10 @@
 		echo Invalid configuration \`$1\': machine \`$basic_machine\' not recognized 1>&2
 		exit 1
 		;;
+	m68k-palmos)
+		basic_machine=m68k-unknown
+		os=-palmos
+		;;
 	# Recognize the basic CPU types with company name.
 	# FIXME: clean up the formatting here.
 	vax-* | tahoe-* | i[234567]86-* | i860-* | ia64-* | m32r-* | m68k-* | m68000-* \
@@ -1017,6 +1021,7 @@
 	      | -mingw32* | -linux-gnu* | -uxpv* | -beos* | -mpeix* | -udk* \
 	      | -interix* | -uwin* | -rhapsody* | -darwin* | -opened* \
 	      | -openstep* | -oskit* | -conix* | -pw32* | -nonstopux* \
+	      | -palmos* \
 	      | -storm-chaos* | -tops10* | -tenex* | -tops20* | -its* | -os2*)
 	# Remember, each alternative MUST END IN *, to match a version number.
 		;;
diff -urN orig-binutils-2.11.2/gas/config/m68k-parse.h binutils-2.11.2/gas/config/m68k-parse.h
--- orig-binutils-2.11.2/gas/config/m68k-parse.h	Thu Jun  7 03:15:26 2001
+++ binutils-2.11.2/gas/config/m68k-parse.h	Thu Jan  3 12:58:31 2002
@@ -240,12 +240,13 @@
   int scale;
 };
 
-#ifdef OBJ_ELF
+#if defined OBJ_ELF || defined COFF_RELEND_RELOC
 /* The type of a PIC expression.  */
 
 enum pic_relocation
 {
   pic_none,			/* not pic */
+  pic_endrel,			/* @END (for COFF_RELEND_RELOC) */
   pic_plt_pcrel,		/* @PLTPC */
   pic_got_pcrel,		/* @GOTPC */
   pic_plt_off,			/* @PLT */
@@ -260,7 +261,7 @@
   /* The size to use.  */
   enum m68k_size size;
 
-#ifdef OBJ_ELF
+#if defined OBJ_ELF || defined COFF_RELEND_RELOC
   /* The type of pic relocation if any.  */
   enum pic_relocation pic_reloc;
 #endif
diff -urN orig-binutils-2.11.2/gas/config/m68k-parse.y binutils-2.11.2/gas/config/m68k-parse.y
--- orig-binutils-2.11.2/gas/config/m68k-parse.y	Thu Jun  7 03:15:26 2001
+++ binutils-2.11.2/gas/config/m68k-parse.y	Mon Jan  7 16:24:32 2002
@@ -973,7 +973,7 @@
 	tail = 2;
     }
 
-#ifdef OBJ_ELF
+#if defined OBJ_ELF || defined COFF_RELEND_RELOC
   {
     /* Look for @PLTPC, etc.  */
     char *cp;
@@ -1005,6 +1005,11 @@
 	    yylval.exp.pic_reloc = pic_got_off;
 	    tail += 4;
 	  }
+	else if (strncmp (cp - 4, "@END", 4) == 0)
+	  {
+	    yylval.exp.pic_reloc = pic_endrel;
+	    tail += 4;
+	  } 
       }
   }
 #endif
diff -urN orig-binutils-2.11.2/gas/config/obj-coff.h binutils-2.11.2/gas/config/obj-coff.h
--- orig-binutils-2.11.2/gas/config/obj-coff.h	Thu Jun  7 03:15:26 2001
+++ binutils-2.11.2/gas/config/obj-coff.h	Tue Jan  8 10:06:39 2002
@@ -25,6 +25,9 @@
 
 #define OBJ_COFF 1
 
+#define COFF_RELEND_RELOC
+#define NEED_FX_R_TYPE
+
 #ifndef BFD_ASSEMBLER
 
 #define WORKING_DOT_WORD
diff -urN orig-binutils-2.11.2/gas/config/tc-m68k.c binutils-2.11.2/gas/config/tc-m68k.c
--- orig-binutils-2.11.2/gas/config/tc-m68k.c	Mon Jun 11 10:04:48 2001
+++ binutils-2.11.2/gas/config/tc-m68k.c	Mon Jan  7 16:40:42 2002
@@ -215,7 +215,7 @@
 	 significance of some values (in the branch instruction, for
 	 example).  */
       int pcrel_fix;
-#ifdef OBJ_ELF
+#if defined OBJ_ELF || defined COFF_RELEND_RELOC
       /* Whether this expression needs special pic relocation, and if
 	 so, which.  */
       enum pic_relocation pic_reloc;
@@ -283,7 +283,7 @@
   the_ins.reloc[the_ins.nrel].exp = exp->exp;
   the_ins.reloc[the_ins.nrel].wid = width;
   the_ins.reloc[the_ins.nrel].pcrel_fix = pc_fix;
-#ifdef OBJ_ELF
+#if defined OBJ_ELF || defined COFF_RELEND_RELOC
   the_ins.reloc[the_ins.nrel].pic_reloc = exp->pic_reloc;
 #endif
   the_ins.reloc[the_ins.nrel++].pcrel = pc_rel;
@@ -692,6 +692,11 @@
 tc_coff_fix2rtype (fixP)
      fixS *fixP;
 {
+#ifdef COFF_RELEND_RELOC
+  if (fixP->fx_r_type != NO_RELOC)
+    return fixP->fx_r_type;
+#endif
+
   if (fixP->fx_tcbit && fixP->fx_size == 4)
     return R_RELLONG_NEG;
 #ifdef NO_PCREL_RELOCS
@@ -875,8 +880,12 @@
 }
 
 #else /* !OBJ_ELF */
-
+#ifdef COFF_RELEND_RELOC
+#define get_reloc_code(SIZE,PCREL,PIC) \
+  (((PIC) == pic_endrel && (SIZE) == 2)? R_RELENDWORD : NO_RELOC)
+#else
 #define get_reloc_code(SIZE,PCREL,OTHER) NO_RELOC
+#endif /* COFF_RELEND_RELOC */
 
 #define relaxable_symbol(symbol) 1
 
diff -urN orig-binutils-2.11.2/gas/configure.in binutils-2.11.2/gas/configure.in
--- orig-binutils-2.11.2/gas/configure.in	Mon Jun 11 10:04:44 2001
+++ binutils-2.11.2/gas/configure.in	Wed Jan  2 14:05:07 2002
@@ -196,6 +196,7 @@
       arm-*-pe | thumb-*-pe)            fmt=coff em=pe ;;
       arm-*-riscix*)	                fmt=aout em=riscix ;;
       arm-*-vxworks)	                fmt=coff ;;
+      arm-*-palmos*)	                fmt=elf ;;
 
       avr-*-*)		    fmt=elf bfd_gas=yes ;;
 
@@ -321,6 +322,7 @@
       m68k-*-openbsd*)      fmt=aout em=nbsd bfd_gas=yes ;;
       m68k-apple-aux*)      fmt=coff em=aux ;;
       m68k-*-psos*)         fmt=elf em=psos;;
+      m68k-*-palmos*)       fmt=coff ;;
 
       m88k-motorola-sysv3*) fmt=coff em=delt88 ;;
       m88k-*-coff*)         fmt=coff ;;
diff -urN orig-binutils-2.11.2/gas/configure binutils-2.11.2/gas/configure
--- orig-binutils-2.11.2/gas/configure	Mon Jun 11 10:04:38 2001
+++ binutils-2.11.2/gas/configure	Wed Jan  2 14:05:07 2002
@@ -2312,6 +2312,7 @@
       arm-*-pe | thumb-*-pe)            fmt=coff em=pe ;;
       arm-*-riscix*)	                fmt=aout em=riscix ;;
       arm-*-vxworks)	                fmt=coff ;;
+      arm-*-palmos*)	                fmt=elf ;;
 
       avr-*-*)		    fmt=elf bfd_gas=yes ;;
 
@@ -2440,6 +2441,7 @@
       m68k-*-openbsd*)      fmt=aout em=nbsd bfd_gas=yes ;;
       m68k-apple-aux*)      fmt=coff em=aux ;;
       m68k-*-psos*)         fmt=elf em=psos;;
+      m68k-*-palmos*)       fmt=coff ;;
 
       m88k-motorola-sysv3*) fmt=coff em=delt88 ;;
       m88k-*-coff*)         fmt=coff ;;
diff -urN orig-binutils-2.11.2/gas/m68k-parse.c binutils-2.11.2/gas/m68k-parse.c
--- orig-binutils-2.11.2/gas/m68k-parse.c	Sun Jun 10 15:37:29 2001
+++ binutils-2.11.2/gas/m68k-parse.c	Mon Jan  7 16:24:35 2002
@@ -1978,7 +1978,7 @@
 	tail = 2;
     }
 
-#ifdef OBJ_ELF
+#if defined OBJ_ELF || defined COFF_RELEND_RELOC
   {
     /* Look for @PLTPC, etc.  */
     char *cp;
@@ -2010,6 +2010,11 @@
 	    yylval.exp.pic_reloc = pic_got_off;
 	    tail += 4;
 	  }
+	else if (strncmp (cp - 4, "@END", 4) == 0)
+	  {
+	    yylval.exp.pic_reloc = pic_endrel;
+	    tail += 4;
+	  } 
       }
   }
 #endif
diff -urN orig-binutils-2.11.2/include/coff/internal.h binutils-2.11.2/include/coff/internal.h
--- orig-binutils-2.11.2/include/coff/internal.h	Thu Jun  7 03:21:39 2001
+++ binutils-2.11.2/include/coff/internal.h	Wed Jan  9 10:24:19 2002
@@ -632,6 +632,10 @@
 #define R_LVRT16       132
 #define R_VRT32        133
 
+/* This (m68k) reloc evaluates to a 16bit offset, just like R_RELWORD, but
+   also implicitly subtracts the value of `edata', so that effectively the
+   origin is at the end of the memory region intead of the start.  */
+#define R_RELENDWORD	21
 
 /* This reloc identifies mov.b instructions with a 16bit absolute
    address.  The linker tries to turn insns with this reloc into
diff -urN orig-binutils-2.11.2/ld/configure.tgt binutils-2.11.2/ld/configure.tgt
--- orig-binutils-2.11.2/ld/configure.tgt	Mon Jun 11 10:05:08 2001
+++ binutils-2.11.2/ld/configure.tgt	Wed Jan  2 14:05:07 2002
@@ -191,6 +191,7 @@
 arm*-*-linux-gnu*)	targ_emul=armelf_linux; targ_extra_emuls=armelf ;;
 arm*-*-uclinux*)	targ_emul=armelf_linux; targ_extra_emuls=armelf ;;
 arm*-*-conix*)		targ_emul=armelf ;;
+arm*-*-palmos*)		targ_emul=armelf ;;
 thumb-*-linux-gnu* | thumb-*-uclinux*)	targ_emul=armelf_linux; targ_extra_emuls=armelf ;;
 strongarm-*-coff)	targ_emul=armcoff ;;
 strongarm-*-elf)	targ_emul=armelf ;;
@@ -242,6 +243,7 @@
 m68*-*-netbsd*)		targ_emul=m68knbsd ;;
 m68*-*-psos*)		targ_emul=m68kpsos ;;
 m68*-*-rtems*)		targ_emul=m68kcoff ;;
+m68*-*-palmos*)		targ_emul=m68kcoff ;;
 hppa*64*-*)		targ_emul=elf64hppa ;;
 hppa*-*-linux-gnu*)	targ_emul=hppalinux ;;
 hppa*-*-*elf*)		targ_emul=hppaelf ;;
